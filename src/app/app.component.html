<ng-template let-popup #exportPopUp>
    <div class="ui content">
        <p class="ui center aligned basic segment">A JSON representation of the chart has just been saved !</p>
    </div>
</ng-template>

<ng-template let-popup #loadPopUp>
    <div class="ui content">
        <div class="ui center aligned basic segment">
            <sui-dimmer class="inverted" [(isDimmed)]="this.chartLoadingService.chartLoadingStatus">
                <div class="ui text loader">Loading Chart</div>
            </sui-dimmer>
            <input id="fileElem" type="file" style="display:none" accept=".json" (change)="loadChart($event)">
            <div class="ui labeled button" (click)="initiateFilePicker()">
                <div class="ui basic icon button"><i class="plus icon"></i></div>
                <div id="fileName" class="ui basic label">{{ (this.loadedChartFile !== null) ? this.loadedChartFile.name : 'Select File'}}</div>
            </div>
        </div>
        <!-- <p class="ui center aligned basic segment">Chart model is loaded!</p> -->
    </div>
</ng-template>

<ng-template let-popup #publishPopUp >
    <div class="ui content">

        <!-- <h4 class="ui centered header">Generated Chart Url</h4>
        <div class="ui small text container segment">
            <p class="url-holder">{{chartExportingService.chartUrl$ | async}}</p>
        </div> -->

        <h4 class="ui centered header">Generated Chart TinyUrl</h4>
        <div class="ui small text container segment">
            <div class="ui active centered inline loader" *ngIf="(chartExportingService.loadingChartTinyUrl$ | async); else chartTinyUrlNotLoading">

            </div>
            <ng-template #chartTinyUrlNotLoading>
                <p class="url-holder">{{chartExportingService.chartTinyUrl$ | async}}</p> 
            </ng-template>
        </div>
        <h4 class="ui centered header">Generated Table TinyUrl</h4>
        <div class="ui small text container segment">
            <div class="ui active centered inline loader" *ngIf="(chartExportingService.loadingTableTinyUrl$ | async); else tableTinyUrlNotLoading">

            </div>
            <ng-template #tableTinyUrlNotLoading>
                <p class="url-holder">{{chartExportingService.tableTinyUrl$ | async}}</p> 
            </ng-template>
        </div>

    </div>
</ng-template>

<div class="ui massive fixed pointing menu">
    <div class="header item">Statistic Chart Generator</div>
    
    <div class="right menu">
        <a class="item" suiPopup (onOpen)="handlePopUpOpen($event)" [popupTemplate]="publishPopUp" [popupPlacement]="popupPlacement" popupTrigger="outsideClick" #publishpopup="suiPopup"
        (click)="togglePublishPopUp(publishpopup)">Publish</a>
        <a class="item" suiPopup [popupTemplate]="loadPopUp" [popupPlacement]="popupPlacement" popupTrigger="outsideClick"
        (click)="loadChart()">Load</a>
        <a class="item" suiPopup [popupTemplate]="exportPopUp" [popupPlacement]="popupPlacement" popupTrigger="outsideClick" #exportpopup="suiPopup"
        (click)="exportChart(exportpopup)" >Export</a>
        <!-- <a class="item">Sign Up</a>
        <a class="item">Help</a> -->
    </div>
</div>

<div class="ui stackable two column divided padded grid">
    <div class="ui seven wide padded column container">
        <chart-creator [loadedChart]="chartModel" (chartSubmit)="handleChartObject($event)" (tableSubmit)="handleTableObject($event)"></chart-creator>
    </div>
    <div class="ui nine wide column container">

        <div  id="iframeBlocker" style="position: absolute; top: 0; left: 0; width:95%; height:95%;z-index:2"></div>
        <chart-frame [chart]="chartObject"></chart-frame>
        
        <div class="ui hidden horizontal divider"></div>
        <chart-data-presentation-table [table]="tableObject"></chart-data-presentation-table>
    </div>
</div>
